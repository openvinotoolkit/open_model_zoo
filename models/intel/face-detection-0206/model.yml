# Copyright (c) 2021 Intel Corporation
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

description: >-
  Face detector based on ResNet152 as a backbone with a ATSS head for indoor and outdoor
  scenes shot by a front-facing camera.
task_type: detection
files:
  # download ote repo as package
  - name: model/develop.zip
    size: 71997236
    sha256: 2e5f60ab42428987a0614f6a4fa71c9a3b083b4b13b812f0b866c013d1921f1d
    source: https://github.com/openvinotoolkit/training_extensions/archive/refs/heads/develop.zip
  # requirments libs
  - name: model/lib/addict-2.4.0-py3-none-any.whl
    size: 3832
    sha256: 249bb56bbfd3cdc2a004ea0ff4c2b6ddc84d53bc2194761636eb314d5cfa5dfc
    source: https://files.pythonhosted.org/packages/6a/00/b08f23b7d7e1e14ce01419a467b583edbb93c6cdb8654e54a9cc579cd61f/addict-2.4.0-py3-none-any.whl
  - name: model/lib/packaging-21.0-py3-none-any.whl
    size: 40357
    sha256: c86254f9220d55e31cc94d69bade760f0847da8000def4dfe1c6b872fd14ff14
    source: https://files.pythonhosted.org/packages/3c/77/e2362b676dc5008d81be423070dd9577fa03be5da2ba1105811900fda546/packaging-21.0-py3-none-any.whl
  - name: model/lib/terminaltables-3.1.0.tar.gz
    size: 12478
    sha256: f3eb0eb92e3833972ac36796293ca0906e998dc3be91fbe1f8615b331b853b81
    source: https://files.pythonhosted.org/packages/9b/c4/4a21174f32f8a7e1104798c445dacdc1d4df86f2f26722767034e4de4bff/terminaltables-3.1.0.tar.gz
  - name: model/lib/mmcv-full-1.3.0.tar.gz
    size: 253880
    sha256: 4103a74604c06b51dae82b96d6d796336aa6c5c38b68235e64b412f9154a901b
    source: https://files.pythonhosted.org/packages/9b/d1/6201ac4b55cd5252a35c9890b65d7629629ca37eed09a072dcbfc96a2817/mmcv-full-1.3.0.tar.gz
  - name: model/training_extensions-develop/external/mmdetection.zip
    size: 7741695
    sha256: 27a96172f28349ff199eb1393dcb8623c621dbe94213ebe5ea17a1a64a2bcd83
    source: https://github.com/openvinotoolkit/mmdetection/archive/4856591efb5c60a1380e574a6c7f8566a9b31dfe.zip
  - name: model/lib/pytorchcv-0.0.55-py2.py3-none-any.whl
    size: 390793
    sha256: 7093a5ba90080f2b20606db34a44d3c1416c716926ffeeb9f7f52133b6284b5b
    source: https://files.pythonhosted.org/packages/a3/66/c8a8bc74e7d5434238c07e083e65212dd1eae10eefa2409285f8aefc1432/pytorchcv-0.0.55-py2.py3-none-any.whl
  # weights
  - name: model/ckpt/snapshot.pth
    size: 511179725
    sha256: 677a04f317d0250193ded307d8ec89e06436e5110f6a61bdef5fe10a17e282ea
    source: https://download.01.org/opencv/openvino_training_extensions/models/object_detection/v2/face-detection-0206.pth
postprocessing:
  - $type: unpack_archive
    format: zip
    file: model/develop.zip
  - $type: unpack_archive
    format: zip
    file: model/lib/addict-2.4.0-py3-none-any.whl
  - $type: unpack_archive
    format: zip
    file: model/lib/pytorchcv-0.0.55-py2.py3-none-any.whl
  - $type: unpack_archive
    format: zip
    file: model/lib/packaging-21.0-py3-none-any.whl
  - $type: unpack_archive
    format: gztar
    file: model/lib/mmcv-full-1.3.0.tar.gz
  - $type: unpack_archive
    format: gztar
    file: model/lib/terminaltables-3.1.0.tar.gz
  - $type: unpack_archive
    format: zip
    file: model/training_extensions-develop/external/mmdetection.zip

  - $type: regex_replace
    pattern: 'openvino:\n    default: true'
    replacement: 'openvino:\n    default: false'
    file: model/training_extensions-develop/models/object_detection/model_templates/face-detection/face-detection-0206/template.yaml
  - $type: regex_replace
    pattern: 'pretrained=True'
    replacement: 'pretrained=False'
    file: model/training_extensions-develop/models/object_detection/model_templates/face-detection/face-detection-0206/model.py
  - $type: regex_replace
    pattern: '\.\.\/\.\.\/\.\.\/external\/mmdetection'
    replacement: '../../external/mmdetection-4856591efb5c60a1380e574a6c7f8566a9b31dfe'
    file: model/training_extensions-develop/ote/ote/__init__.py
  # delete extra libs
  - $type: regex_replace
    pattern: 'from yapf'
    replacement: '# \g<0>'
    file: model/lib/mmcv-full-1.3.0/mmcv/utils/config.py
  - $type: regex_replace
    pattern: '.*_requires?='
    replacement: '# \g<0>'
    file: model/lib/mmcv-full-1.3.0/setup.py
  - $type: regex_replace
    pattern: 'from onnxoptimizer|optimize_onnx_graph\(onnx_model_path\)\n'
    replacement: '# \g<0>'
    file: model/training_extensions-develop/external/mmdetection-4856591efb5c60a1380e574a6c7f8566a9b31dfe/tools/export.py
  - $type: regex_replace
    pattern: '(from|import) (pycocotools|matplotlib|editdistance|tqdm|Polygon )'
    replacement: '# \g<0>'
    file: model/training_extensions-develop/external/mmdetection-4856591efb5c60a1380e574a6c7f8566a9b31dfe/mmdet/**/*.py
  - $type: regex_replace
    pattern: 'try(.|\n)*?except.*\n.*raise(.*?)\((.|\n)*?\)'
    replacement: ''
    file: model/training_extensions-develop/external/mmdetection-4856591efb5c60a1380e574a6c7f8566a9b31dfe/mmdet/datasets/coco.py
model_optimizer_args:
  - --input_shape=[1, 3, 640, 640]
  - --reverse_input_channels
  - --mean_values=[123.675, 116.28, 103.53]
  - --scale_values=[58.395, 57.12, 57.375]
  - --input=image
  - --output=boxes,labels
  - --input_model=$conv_dir/model.onnx
framework: onnx
license: https://raw.githubusercontent.com/openvinotoolkit/training_extensions/develop/LICENSE
