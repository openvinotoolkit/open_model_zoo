models:
  - name: machine-translation-nar-ru-en-0001
    launchers:
      - framework: dlsdk
        adapter:
          type: narnmt
          vocabulary_file: tokenizer_tgt/vocab.json
          merges_file: tokenizer_tgt/merges.txt
          output_name: pred/Squeeze
        inputs:
          - name: "tokens"
            value: 'tokens'
            type: INPUT

    datasets:
      - name: WMT
        annotation_conversion:
          converter: wmt
          input_file: wmt19-ru-en.ru.spbpe
          reference_file: wmt19-ru-en.en.spbpe

        reader:
          type: annotation_features_extractor
          features:
            - source

        preprocessing:
          - type: decode_by_sentence_piece_bpe_tokenizer
            vocabulary_file: tokenizer_src/vocab.json
            merges_file: tokenizer_src/merges.txt

          - type: pad_with_eos
            eos_index: 1
            sequence_len: 192

        metrics:
          - type: bleu
            smooth: True